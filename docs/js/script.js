var canvas=document.getElementById("canvas"),saveButton=document.getElementById("save");function generateImage(){var i=canvas.getContext("2d"),t=new Image,o=$("#string").val(),e=GeoPattern.generate(o);t.onload=function(){canvas.width=$("#width").val(),canvas.height=$("#height").val();var t=document.createElement("canvas");t.width=this.width,t.height=this.height,t.getContext("2d").drawImage(this,0,0,this.width,this.height);var e=i.createPattern(t,"repeat");i.fillStyle=e,i.fillRect(0,0,$("#width").val(),$("#height").val());var n=$("#title").val().split("\n"),a=$("#height").val()/2-(n.length-1)*$("#font-size").val()/2;drawString(i,$("#title").val(),$("#width").val()/2,a,$("#font-color").val(),$("#font-family").val(),$("#font-size").val(),$("#font-weight:checked").val()),saveButton.download=o+".png";try{saveButton.href=canvas.toDataURL("image/png")}catch(t){saveButton.style.display="none"}},t.src=e.toDataUri()}function drawString(t,e,n,a,o,l,r,g){var h=e.split("\n");for(l||(l="'sans-serif, serif'"),r||(r=16),o||(o="#000000"),t.save(),t.font=g?"bold "+r+"px "+l:r+"px "+l,t.textAlign="center",t.textBaseline="middle",t.fillStyle=o,t.translate(n,a),i=0;i<h.length;i++)t.fillText(h[i],0,r*i*1.1);t.restore()}function randomWords(){var t=["文字を入力してください"];return t[Math.floor(Math.random()*t.length)]}$(function(){$("#title").val(randomWords()),$("#title, #font-family, #font-size, #width, #height, #string").on("input",function(t){generateImage()}),$("#font-weight").on("change",function(t){generateImage()}),$("#font-color").colorpicker().on("colorpickerChange",function(t){generateImage()}),$("#string").trigger("input"),$("#title").focus(),$("#title").select()});